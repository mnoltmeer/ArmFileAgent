# ArmFileAgent
АС «Файловий агент АРМ ВЗ». Змінена та покращена версія АС «Менеджер файлів АРМ ВЗ».

Використовує сервер конфігурацій для визначення переліку файлів, що призначені для роботи окремого екземпляру Програми. Може запускати виконавчі та командні файли, скрипти на мові ELI.

Відмінності від АС «Менеджер файлів АРМ ВЗ»:

- з контекстного меню іконки в треї прибрані пункти "Показати головне вікно", "Відобразити/приховати перелік файлів" та "Перечитати конфіги".
	
- вікна для відображення переліку файлів більше недоступні.
	
- головне вікно Програми більше недоступне, Програма запускається тільки в прихованому режимі.
	
- параметри RegionID, HideWnd, UseGuardian, GuardianUpdatesPath, UseCollector, CollectorHost, CollectorPort, FirewallRule, EnableAutoStart, AutoStartForAllUsers, ControlScriptName, ScriptInterval, з головного конфігу Програми більше не використовуються.
	
- параметри конфігів з'єднань MaxTry та ConnInterval більше не використовуються, натомість Програма буде виконувати спроби підключитись до серверу з інтервалом у MonitoringInterval і писати в лог помилку, якщо сервер недоступний.
	
- параметр TimeStart з конфігів з'єднань більше не використовується. Замість того у параметрі StartAtTime вказується час бажаного старту з'єдання, або порожнє значення, якщо використовувати запуск за розкладом не потрібно.
	
- прибрані спливаючі вікна, що сповіщали про запуск Програми.
	
- всі робочі файли Програми (незважаючи на місцезнаходження exe-файлу) тепер розташовані у каталозі %USERPROFILE%\Documents\AFAgent\Data. Увага: виконавчий файл Програми НЕ МОЖЕ знаходитись у цьому каталозі!
	
- додано нову внутрішню змінну $DataPath, що містить шлях до каталогу з даними Програми.
	
- з'єднання тепер ініціалізуються одразу, коли надходить новий конфіг-файл, а не тільки під час запуску Програми.
	
- керуючі скрипти тепер виконуються одразу, коли надходять у Програму.
	
- під час запуску Програма отримує перелік файлів для завантаження, сама визначає які потребують оновлення і завантажує їх. Якщо файлом є конфіг з'єднання, він одразу запускається і починає роботу. Після старту Програма буде запитувати від сервера конфігурацій оновлений перелік файлів кожні 10 хвилин. Якщо для існуючого з'єднання надійшов оновлений конфіг, воно знищується і одразу ініціалізується заново.
	
- під час кожного запиту переліку файлів Програма видаляє з каталогу даних файли, що не входять до переліку, який отримано від серверу.
	
- якщо Програма завантажує з сервера конфігурацій виконавчий файл (.exe, .bat, .cmd), він буде автоматично запущений.
	
- якщо на момент запуску Програми в робочому каталозі наявні виконавчі файли, вони будуть запущені (за умови, що вони ще не в роботі).
	
- основні налаштування Програма зберігає у системному реєстрі (HKEY_LOCAL_MACHINE), причому записує їх туди лише один раз під час процедури ініціалізації. В подальшому в реєстр пишеться тільки шлях до виконавчого файлу у розділ HKEY_CURRENT_USER.
	
- з консолі адміністрування прибрані: функціонал масової розсилки команд, можливість редагування, видалення та додання конфігів.
	
- в консоль адміністрування додана можливість надсилати керуючий скрипт та отримувати адресну книгу з сервера конфігурацій.
	
- Guardian тепер виконує лише дві функції: контроль запущеного стану Програми та її оновлення. Процес оновленя також було спрощено: коли надходить оновлений модуль Програми, вона надсилає повідомленя-запит, Гардіан у відповідь дає команду коректного завершення роботи і чекає 10 секунд. Якщо за цей час роботу Програми не було завершено, Гардіан примусово завершує процес Програми і виконує оновлення.
